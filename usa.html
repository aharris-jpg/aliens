 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Alien Hotspots — U.S. States Ranked by Implied Abduction-Report Odds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- D3 + TopoJSON -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>

  <style>
    :root{
      /* ===== UFO NIGHT: GREEN -> TEAL MAP + WARM GOLD TEXT ACCENTS ===== */
      --bgTop:#060014;
      --bgBottom:#01010a;
      --ink:#ffffff;

      /* Warm editorial accents (titles / key labels) */
      --warm:#FFB703;      /* solar gold */
      --warm2:#FF7A59;     /* living coral (very light use) */

      /* Cool glow accents (links/hover) */
      --cool:#35E7FF;      /* electric cyan */

      /* FINAL MAP RAMP (LOW -> HIGH): mint -> neon green -> teal -> deep teal */
      --m0:#E9FFF4;
      --m1:#B8FFD9;
      --m2:#5CFFB0;
      --m3:#15E6C2;
      --m4:#08A6A6;
      --m5:#034C4F;

      --card:rgba(255,255,255,0.06);
      --border:rgba(255,255,255,0.12);
      --shadow:0 18px 55px rgba(0,0,0,0.50);

      --font: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;

      --radius:18px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:var(--font);
      color:var(--ink);
      min-height:100vh;
      padding:24px 14px 28px;
      background:
        radial-gradient(1100px 650px at 78% 15%, rgba(92,255,176,0.14), transparent 56%),
        radial-gradient(900px 620px at 18% 14%, rgba(53,231,255,0.10), transparent 56%),
        radial-gradient(900px 650px at 55% 85%, rgba(255,183,3,0.08), transparent 60%),
        linear-gradient(180deg, var(--bgTop), var(--bgBottom));
      overflow-x:hidden;
      position:relative;
    }

    /* subtle stars */
    body:before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,0.70) 50%, transparent 52%),
        radial-gradient(2px 2px at 68% 12%, rgba(255,255,255,0.55) 50%, transparent 52%),
        radial-gradient(1.5px 1.5px at 44% 26%, rgba(255,255,255,0.55) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 84% 36%, rgba(255,255,255,0.45) 50%, transparent 52%),
        radial-gradient(1.4px 1.4px at 18% 42%, rgba(255,255,255,0.45) 50%, transparent 52%),
        radial-gradient(2px 2px at 30% 70%, rgba(255,255,255,0.40) 50%, transparent 52%),
        radial-gradient(1.4px 1.4px at 76% 74%, rgba(255,255,255,0.40) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 55% 88%, rgba(255,255,255,0.42) 50%, transparent 52%);
      opacity:0.46;
      mix-blend-mode:screen;
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      position:relative;
    }

    /* Header */
    .hero{
      position:relative;
      text-align:center;
      padding:8px 0 10px;
      margin-bottom:12px;
    }

    .title{
      margin:0;
      font-weight:950;
      letter-spacing:0.03em;
      line-height:0.92;
      font-size:clamp(44px, 6.2vw, 70px);
      text-transform:uppercase;
      background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(92,255,176,0.92));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow:0 14px 54px rgba(92,255,176,0.12);
    }

    .subtitle{
      margin:10px auto 0;
      max-width:840px;
      color:rgba(255,255,255,0.92);
      font-weight:850;
      font-size:clamp(14px, 1.9vw, 18px);
    }

    /* Header accents (kept away from text) */
    .header-accent{
      position:absolute;
      pointer-events:none;
      opacity:0.50;
      z-index:0;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .header-accent.left{
      left:-18px; top:-6px;
      width:52px;
      transform: rotate(-10deg);
      filter:
        hue-rotate(110deg)
        saturate(2.0)
        brightness(1.06)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .header-accent.right{
      right:-46px; top:-34px;
      width:128px;
      transform: rotate(10deg);
      filter:
        hue-rotate(135deg)
        saturate(1.8)
        brightness(1.06)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    @media (max-width: 640px){
      .header-accent.left{ left:-10px; top:-2px; width:46px; }
      .header-accent.right{ right:-34px; top:-26px; width:112px; }
    }

    /* Card */
    .card{
      position:relative;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(6px);
    }

    .map-area{
      padding:14px 14px 10px;
      position:relative;
    }

    .map-shell{
      position:relative;
      padding:14px; /* safe zone for decors */
    }

    /* Decorative accents OUTSIDE the map frame */
    .decor{
      position:absolute;
      pointer-events:none;
      z-index:0;
      opacity:0.22;
      filter:
        hue-rotate(125deg)
        saturate(2.0)
        brightness(1.06)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .decor.hero-ufo{
      width:140px;
      top:-50px;
      right:-70px;
      opacity:0.26;
      transform: rotate(12deg);
      filter:
        hue-rotate(145deg)
        saturate(1.9)
        brightness(1.08)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .decor.small{ width:44px; }
    .decor.left{ left:-30px; top:165px; transform: rotate(-8deg); }
    .decor.right{ right:-28px; top:245px; transform: rotate(10deg); }
    .decor.bottom-left{ left:-22px; bottom:125px; transform: rotate(12deg); }
    .decor.bottom-right{ right:-22px; bottom:98px; transform: rotate(-10deg); }

    /* extra tiny accents */
    .decor.tiny{ width:30px; opacity:0.14; }
    .decor.top-left{ left:8px; top:8px; transform: rotate(-10deg); }
    .decor.top-right{ right:12px; top:12px; transform: rotate(14deg); opacity:0.12; }
    .decor.mid-left{ left:-14px; top:220px; transform: rotate(-8deg); opacity:0.12; }
    .decor.mid-right{ right:-12px; top:210px; transform: rotate(9deg); opacity:0.12; }

    .map-frame{
      position:relative;
      z-index:1;
      background:rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:16px;
      overflow:hidden;
    }

    /* subtle “scanner glow” behind the frame */
    .map-frame:before{
      content:"";
      position:absolute; inset:-22px;
      background:
        radial-gradient(520px 260px at 28% 18%, rgba(92,255,176,0.16), transparent 62%),
        radial-gradient(520px 280px at 72% 85%, rgba(21,230,194,0.12), transparent 64%),
        radial-gradient(520px 260px at 70% 15%, rgba(53,231,255,0.10), transparent 62%);
      filter: blur(12px);
      opacity:0.90;
      pointer-events:none;
    }

    svg{
      width:100%;
      height:auto;
      display:block;
      position:relative;
      z-index:1; /* above the glow */
    }

    /* Bigger gaps between states */
    .state{
      stroke:rgba(1,1,10,1);
      stroke-width:6.4;
      stroke-linejoin:round;
      stroke-linecap:round;
      cursor:default;
    }
    .state:hover{
      stroke:rgba(255,255,255,0.78);
      stroke-width:6.4;
      filter:
        drop-shadow(0 0 10px rgba(92,255,176,0.18))
        drop-shadow(0 0 14px rgba(53,231,255,0.10));
    }
    .state-outline{
      fill:none;
      stroke:rgba(255,255,255,0.08);
      stroke-width:0.85;
      pointer-events:none;
    }

    /* Legend */
    .legend{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      padding:10px 14px 14px;
    }
    .legend .label{
      font-size:12px;
      font-weight:950;
      letter-spacing:0.06em;
      text-transform:uppercase;
      color:rgba(255,255,255,0.84);
      white-space:nowrap;
    }
    .legend .bar{
      width:min(360px, 68vw);
      height:14px;
      border-radius:999px;
      background:linear-gradient(90deg, var(--m0), var(--m1), var(--m2), var(--m3), var(--m4), var(--m5));
      border:1px solid rgba(255,255,255,0.18);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.18);
    }

    .bigline{
      text-align:center;
      padding:8px 14px 0;
      font-weight:950;
      letter-spacing:0.04em;
      text-transform:uppercase;
      color:rgba(255,183,3,0.92); /* warm gold */
      font-size:clamp(14px, 2vw, 16px);
    }

    /* Ranked list */
    .lists{
      padding:12px 14px 10px;
      display:grid;
      gap:10px;
      grid-template-columns:1fr;
    }
    @media (min-width: 760px){
      .lists{ grid-template-columns:repeat(3, 1fr); gap:14px; }
    }

    .col{
      background:rgba(0,0,0,0.10);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      padding:10px 10px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      padding:6px 6px;
      border-bottom:1px dashed rgba(255,255,255,0.10);
      font-size:14px;
      line-height:1.1;
    }
    .row:last-child{ border-bottom:none; }

    .name{
      font-weight:950;
      color:rgba(255,183,3,0.92); /* warm gold names */
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .val{
      font-family:var(--mono);
      font-variant-numeric:tabular-nums;
      color:rgba(255,255,255,0.92);
      font-weight:950;
      white-space:nowrap;
    }

    /* Tooltip */
    .tooltip{
      position:absolute;
      pointer-events:none;
      display:none;
      z-index:100;
      background:rgba(6,0,20,0.92);
      border:1px solid rgba(255,255,255,0.16);
      border-radius:14px;
      padding:10px 12px;
      box-shadow:0 16px 40px rgba(0,0,0,0.45);
      max-width:260px;
      backdrop-filter: blur(8px);
    }
    .tooltip strong{
      display:block;
      font-weight:950;
      margin-bottom:4px;
      color:rgba(255,255,255,0.95);
    }
    .tooltip .mono{
      font-family:var(--mono);
      font-variant-numeric:tabular-nums;
      color:rgba(92,255,176,0.92);
      font-weight:950;
    }
    .tooltip .muted{
      margin-top:4px;
      font-size:11px;
      color:rgba(255,255,255,0.70);
    }

    /* Footer */
    .footer{
      margin-top:12px;
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background:rgba(0,0,0,0.16);
      border-top:1px solid rgba(255,255,255,0.10);
      position:relative;
    }

    .source{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      color:rgba(255,255,255,0.86);
      font-weight:900;
      letter-spacing:0.04em;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .source a{
      color:rgba(53,231,255,0.92);
      text-decoration:none;
      border-bottom:1px dotted rgba(53,231,255,0.55);
      font-weight:950;
      text-transform:none;
      letter-spacing:0;
    }

    .logo{
      height:58px;
      width:auto;
      display:block;
      filter: drop-shadow(0 12px 22px rgba(0,0,0,0.45));
    }

    .footer-art{
      display:flex;
      align-items:flex-end;
      gap:10px;
      pointer-events:none;
      opacity:0.90;
    }
    .footer-art img:nth-child(1){
      height:36px;
      transform: rotate(-6deg);
      filter: hue-rotate(145deg) saturate(1.9) brightness(1.08) drop-shadow(0 14px 22px rgba(0,0,0,0.45));
    }
    .footer-art img:nth-child(2){
      height:44px;
      transform: rotate(10deg) translateY(2px);
      filter: hue-rotate(30deg) saturate(1.6) brightness(1.10) drop-shadow(0 14px 22px rgba(0,0,0,0.45));
    }

    /* Methodology block */
    .method{
      padding:10px 14px 14px;
      font-size:11px;
      line-height:1.35;
      color:rgba(255,255,255,0.72);
      border-top:1px solid rgba(255,255,255,0.08);
      background:rgba(0,0,0,0.10);
    }
    .method strong{ color:rgba(255,255,255,0.88); }

    /* Embed */
    .embed{
      padding:12px 14px 16px;
      background:rgba(0,0,0,0.10);
      border-top:1px solid rgba(255,255,255,0.08);
    }
    .embed-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,0.18);
      background:linear-gradient(90deg, rgba(255,183,3,0.95), rgba(255,122,89,0.88));
      color:#01010a;
      font-weight:950;
      letter-spacing:0.02em;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 14px 30px rgba(0,0,0,0.30);
    }
    .embed-btn:hover{ filter:brightness(1.03); transform: translateY(-1px); }
    .embed-panel[hidden]{ display:none; }
    .embed-panel{
      margin-top:10px;
      border:1px solid rgba(255,255,255,0.12);
      border-radius:14px;
      overflow:hidden;
      background:rgba(1,1,10,0.55);
    }
    .embed-panel .hint{
      padding:10px 12px;
      font-size:11px;
      color:rgba(255,255,255,0.72);
      border-bottom:1px solid rgba(255,255,255,0.10);
    }
    .embed-panel textarea{
      width:100%;
      height:130px;
      padding:10px 12px;
      border:0;
      outline:none;
      resize:none;
      background:transparent;
      color:rgba(255,255,255,0.92);
      font:12px/1.4 var(--mono);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <h1 class="title">Alien Hotspots</h1>
      <div class="subtitle">Implied odds of reported alien abductions, by state</div>

      <!-- minimal header accents -->
      <img class="header-accent left"
           src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
           alt="" aria-hidden="true">
      <img class="header-accent right"
           src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
           alt="" aria-hidden="true">
    </div>

    <div class="card">
      <div class="map-area">
        <div class="map-shell">
          <!-- accents OUTSIDE map frame -->
          <img class="decor hero-ufo"
               src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
               alt="" aria-hidden="true">

          <img class="decor small left"
               src="https://i.postimg.cc/BvT5qYTs/1083598.png"
               alt="" aria-hidden="true">

          <img class="decor small right"
               src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
               alt="" aria-hidden="true">

          <img class="decor small bottom-left"
               src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
               alt="" aria-hidden="true">

          <img class="decor small bottom-right"
               src="https://i.postimg.cc/BvT5qYTs/1083598.png"
               alt="" aria-hidden="true">

          <!-- extra tiny accents -->
          <img class="decor tiny top-left"
               src="https://i.postimg.cc/BvT5qYTs/1083598.png"
               alt="" aria-hidden="true">

          <img class="decor tiny mid-left"
               src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
               alt="" aria-hidden="true">

          <img class="decor tiny top-right"
               src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
               alt="" aria-hidden="true">

          <img class="decor tiny mid-right"
               src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
               alt="" aria-hidden="true">

          <div class="map-frame">
            <svg id="map" viewBox="0 0 975 610" role="img" aria-label="Alien Hotspots map"></svg>
          </div>
        </div>
      </div>

      <div class="legend" aria-label="Legend">
        <div class="label">Lower odds</div>
        <div class="bar" aria-hidden="true"></div>
        <div class="label">Higher odds</div>
      </div>

      <div class="bigline">Implied odds — % and “1 in X”</div>
      <div class="lists" id="lists"></div>

      <div class="footer">
        <div class="source">
          Source: Canada Sports Betting
          <a href="https://www.canadasportsbetting.ca/" target="_blank" rel="noopener">canadasportsbetting.ca</a>
        </div>

        <img class="logo" src="https://i.postimg.cc/5NCzmKXQ/download.png" alt="Canada Sports Betting logo" />

        <div class="footer-art" aria-hidden="true">
          <img src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png" alt="">
          <img src="https://i.postimg.cc/BvT5qYTs/1083598.png" alt="">
        </div>
      </div>

      <div class="method">
        <strong>Methodology:</strong> Per-capita ranking of abduction-style UFO reports (2019–2024). % and “1 in X” are implied odds for comparison only (not predictions).
        <br><br>
        <strong>Sources:</strong> NUFORC, Canadian UFO Survey, U.S. Census Bureau, Statistics Canada, CDC (sleep), Google Trends.
      </div>

      <div class="embed">
        <button class="embed-btn" id="embedToggle" type="button" aria-controls="embedPanel" aria-expanded="false">
          Get embed code
        </button>

        <div class="embed-panel" id="embedPanel" hidden>
          <div class="hint">Copy/paste this iframe. Replace the <strong>src</strong> with your hosted URL.</div>
          <textarea id="embedCode" readonly onclick="this.select()"></textarea>
        </div>
      </div>
    </div>
  </div>

  <div class="tooltip" id="tt"></div>

  <script>
    // === Your data (U.S.) ===
    const alienData = {
      "New Hampshire":  { abbr:"NH", rank: 1,  score:100.00, prob:2.00, oddsX:50  },
      "Idaho":          { abbr:"ID", rank: 2,  score:95.21,  prob:1.90, oddsX:53  },
      "Vermont":        { abbr:"VT", rank: 3,  score:89.63,  prob:1.79, oddsX:56  },
      "Maine":          { abbr:"ME", rank: 4,  score:89.07,  prob:1.78, oddsX:56  },
      "Oregon":         { abbr:"OR", rank: 5,  score:83.86,  prob:1.68, oddsX:60  },
      "Washington":     { abbr:"WA", rank: 6,  score:82.80,  prob:1.66, oddsX:60  },
      "Montana":        { abbr:"MT", rank: 7,  score:81.90,  prob:1.64, oddsX:61  },
      "Wyoming":        { abbr:"WY", rank: 8,  score:73.29,  prob:1.47, oddsX:68  },
      "Arizona":        { abbr:"AZ", rank: 9,  score:71.82,  prob:1.44, oddsX:70  },
      "Connecticut":    { abbr:"CT", rank:10,  score:71.60,  prob:1.43, oddsX:70  },
      "Hawaii":         { abbr:"HI", rank:11,  score:70.23,  prob:1.40, oddsX:71  },
      "West Virginia":  { abbr:"WV", rank:12,  score:69.60,  prob:1.39, oddsX:72  },
      "Colorado":       { abbr:"CO", rank:13,  score:67.99,  prob:1.36, oddsX:74  },
      "Alaska":         { abbr:"AK", rank:14,  score:65.17,  prob:1.30, oddsX:77  },
      "Arkansas":       { abbr:"AR", rank:15,  score:64.48,  prob:1.29, oddsX:78  },
      "Nevada":         { abbr:"NV", rank:16,  score:64.32,  prob:1.29, oddsX:78  },
      "California":     { abbr:"CA", rank:17,  score:63.92,  prob:1.28, oddsX:78  },
      "Florida":        { abbr:"FL", rank:18,  score:62.68,  prob:1.25, oddsX:80  },
      "Pennsylvania":   { abbr:"PA", rank:19,  score:60.89,  prob:1.22, oddsX:82  },
      "Delaware":       { abbr:"DE", rank:20,  score:56.98,  prob:1.14, oddsX:88  },
      "Ohio":           { abbr:"OH", rank:21,  score:56.32,  prob:1.13, oddsX:89  },
      "Utah":           { abbr:"UT", rank:22,  score:55.87,  prob:1.12, oddsX:90  },
      "Rhode Island":   { abbr:"RI", rank:23,  score:55.00,  prob:1.10, oddsX:91  },
      "Missouri":       { abbr:"MO", rank:24,  score:54.43,  prob:1.09, oddsX:92  },
      "New York":       { abbr:"NY", rank:25,  score:54.23,  prob:1.08, oddsX:92  },
      "Kentucky":       { abbr:"KY", rank:26,  score:53.71,  prob:1.07, oddsX:93  },
      "Tennessee":      { abbr:"TN", rank:27,  score:52.31,  prob:1.05, oddsX:96  },
      "Kansas":         { abbr:"KS", rank:28,  score:51.46,  prob:1.03, oddsX:97  },
      "South Carolina": { abbr:"SC", rank:29,  score:51.41,  prob:1.03, oddsX:97  },
      "Alabama":        { abbr:"AL", rank:30,  score:50.61,  prob:1.01, oddsX:99  },
      "Oklahoma":       { abbr:"OK", rank:31,  score:49.98,  prob:1.00, oddsX:100 },
      "New Jersey":     { abbr:"NJ", rank:32,  score:49.43,  prob:0.99, oddsX:101 },
      "South Dakota":   { abbr:"SD", rank:33,  score:48.65,  prob:0.97, oddsX:103 },
      "Virginia":       { abbr:"VA", rank:34,  score:47.90,  prob:0.96, oddsX:104 },
      "Wisconsin":      { abbr:"WI", rank:35,  score:47.73,  prob:0.95, oddsX:105 },
      "Massachusetts":  { abbr:"MA", rank:36,  score:47.62,  prob:0.95, oddsX:105 },
      "Georgia":        { abbr:"GA", rank:37,  score:46.51,  prob:0.93, oddsX:108 },
      "Maryland":       { abbr:"MD", rank:38,  score:46.48,  prob:0.93, oddsX:108 },
      "Michigan":       { abbr:"MI", rank:39,  score:46.36,  prob:0.93, oddsX:108 },
      "Texas":          { abbr:"TX", rank:40,  score:45.63,  prob:0.91, oddsX:110 },
      "North Carolina": { abbr:"NC", rank:41,  score:45.28,  prob:0.91, oddsX:110 },
      "Illinois":       { abbr:"IL", rank:42,  score:43.73,  prob:0.87, oddsX:115 },
      "Iowa":           { abbr:"IA", rank:43,  score:43.26,  prob:0.87, oddsX:115 },
      "North Dakota":   { abbr:"ND", rank:44,  score:42.46,  prob:0.85, oddsX:118 },
      "Louisiana":      { abbr:"LA", rank:45,  score:42.11,  prob:0.84, oddsX:119 },
      "Minnesota":      { abbr:"MN", rank:46,  score:41.46,  prob:0.83, oddsX:121 },
      "Mississippi":    { abbr:"MS", rank:47,  score:39.38,  prob:0.79, oddsX:127 },
      "Nebraska":       { abbr:"NE", rank:48,  score:35.22,  prob:0.70, oddsX:143 },
      "Indiana":        { abbr:"IN", rank:49,  score:20.02,  prob:0.40, oddsX:250 },
      "New Mexico":     { abbr:"NM", rank:50,  score:11.60,  prob:0.23, oddsX:431 }
    };

    // Quantized color scale (FINAL GREEN -> TEAL)
    const ramp = ["#E9FFF4","#B8FFD9","#5CFFB0","#15E6C2","#08A6A6","#034C4F"];
    const color = d3.scaleQuantize().domain([0, 100]).range(ramp);

    const svg = d3.select("#map");
    const tooltip = d3.select("#tt");

    const W = 975, H = 610;
    const projection = d3.geoAlbersUsa().scale(1300).translate([W/2, H/2]);
    const path = d3.geoPath(projection);

    function esc(s){
      return String(s).replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }

    function placeTooltip(event){
      const rect = tooltip.node().getBoundingClientRect();
      const pad = 10;
      let x = event.pageX + 12;
      let y = event.pageY + 12;
      if (x + rect.width > window.innerWidth - pad) x = window.innerWidth - rect.width - pad;
      if (y + rect.height > window.innerHeight - pad) y = window.innerHeight - rect.height - pad;
      tooltip.style("left", x+"px").style("top", y+"px");
    }

    function showTip(event, stateName, d){
      tooltip
        .style("display","block")
        .html(
          `<strong>${esc(stateName)} (${d.abbr})</strong>
           <div class="mono">${d.prob.toFixed(2)}% • 1 in ${d.oddsX}</div>
           <div class="muted">Implied odds • Rank ${d.rank}</div>`
        );
      placeTooltip(event);
    }
    function hideTip(){ tooltip.style("display","none"); }

    // Build 3-column ranked list
    const rows = Object.entries(alienData)
      .map(([state, v]) => ({ state, ...v }))
      .sort((a,b)=>a.rank-b.rank);

    const cols = 3;
    const perCol = Math.ceil(rows.length / cols);
    const lists = document.getElementById("lists");
    lists.innerHTML = "";

    for(let c=0; c<cols; c++){
      const start = c*perCol;
      const chunk = rows.slice(start, start+perCol);
      const col = document.createElement("div");
      col.className = "col";
      col.innerHTML = chunk.map(r => `
        <div class="row">
          <div class="name">${esc(r.state)}</div>
          <div class="val">${r.prob.toFixed(2)}% · 1 in ${r.oddsX}</div>
        </div>
      `).join("");
      lists.appendChild(col);
    }

    // Draw map
    d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json").then(us => {
      const states = topojson.feature(us, us.objects.states).features;
      svg.attr("viewBox", `0 0 ${W} ${H}`);

      svg.selectAll("path.state")
        .data(states)
        .join("path")
        .attr("class","state")
        .attr("d", path)
        .attr("fill", d => {
          const name = d.properties && d.properties.name;
          const data = alienData[name];
          return data ? color(data.score) : "rgba(255,255,255,0.10)";
        })
        .on("mousemove", (event, d) => {
          const name = d.properties && d.properties.name;
          const data = alienData[name];
          if(!data) return hideTip();
          showTip(event, name, data);
        })
        .on("mouseout", hideTip)
        .on("click", (event, d) => {
          const name = d.properties && d.properties.name;
          const data = alienData[name];
          if(!data) return hideTip();
          showTip(event, name, data);
          event.stopPropagation();
        });

      svg.append("path")
        .datum(topojson.mesh(us, us.objects.states, (a,b)=>a!==b))
        .attr("class","state-outline")
        .attr("d", path);

      document.addEventListener("click", hideTip);
      document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") hideTip(); });
    });

    // Embed logic
    const embedToggle = document.getElementById("embedToggle");
    const embedPanel  = document.getElementById("embedPanel");
    const embedCode   = document.getElementById("embedCode");

    if (embedCode) {
      embedCode.value =
`<iframe
  src="https://aharris-jpg.github.io/aliens/usa.html"
  title="Alien Hotspots — Implied odds of reported alien abductions, by state"
  width="100%" height="900"
  style="border:0;overflow:hidden;display:block;width:100%;"
  loading="lazy"></iframe>`;
    }

    if (embedToggle) {
      embedToggle.addEventListener("click", () => {
        const hidden = embedPanel.hasAttribute("hidden");
        if (hidden) {
          embedPanel.removeAttribute("hidden");
          embedToggle.setAttribute("aria-expanded", "true");
          embedToggle.textContent = "Hide embed code";
        } else {
          embedPanel.setAttribute("hidden", "");
          embedToggle.setAttribute("aria-expanded", "false");
          embedToggle.textContent = "Get embed code";
        }
      });
    }
  </script>
</body>
</html>
