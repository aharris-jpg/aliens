<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Alien Hotspots — Canada Provinces Ranked by Implied Abduction-Report Odds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- D3 + TopoJSON (same approach as the USA map) -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>

  <style>
    :root{
      /* ===== UFO NIGHT: GREEN -> TEAL MAP + WARM GOLD TEXT ACCENTS ===== */
      --bgTop:#060014;
      --bgBottom:#01010a;
      --ink:#ffffff;

      /* Warm editorial accents */
      --warm:#FFB703;
      --warm2:#FF7A59;

      /* Cool glow accents */
      --cool:#35E7FF;

      /* Map ramp (LOW -> HIGH): mint -> neon green -> teal -> deep teal */
      --m0:#E9FFF4;
      --m1:#B8FFD9;
      --m2:#5CFFB0;
      --m3:#15E6C2;
      --m4:#08A6A6;
      --m5:#034C4F;

      /* Territories / No-data: lighter, cooler slate-green so Canada reads as “present” */
      --nodata:#4A5E59;

      --card:rgba(255,255,255,0.06);
      --border:rgba(255,255,255,0.12);
      --shadow:0 18px 55px rgba(0,0,0,0.50);

      --font: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;

      --radius:18px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:var(--font);
      color:var(--ink);
      min-height:100vh;
      padding:24px 14px 28px;
      background:
        radial-gradient(1100px 650px at 78% 15%, rgba(92,255,176,0.14), transparent 56%),
        radial-gradient(900px 620px at 18% 14%, rgba(53,231,255,0.10), transparent 56%),
        radial-gradient(900px 650px at 55% 85%, rgba(255,183,3,0.08), transparent 60%),
        linear-gradient(180deg, var(--bgTop), var(--bgBottom));
      overflow-x:hidden;
      position:relative;
    }

    /* subtle stars */
    body:before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,0.70) 50%, transparent 52%),
        radial-gradient(2px 2px at 68% 12%, rgba(255,255,255,0.55) 50%, transparent 52%),
        radial-gradient(1.5px 1.5px at 44% 26%, rgba(255,255,255,0.55) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 84% 36%, rgba(255,255,255,0.45) 50%, transparent 52%),
        radial-gradient(1.4px 1.4px at 18% 42%, rgba(255,255,255,0.45) 50%, transparent 52%),
        radial-gradient(2px 2px at 30% 70%, rgba(255,255,255,0.40) 50%, transparent 52%),
        radial-gradient(1.4px 1.4px at 76% 74%, rgba(255,255,255,0.40) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 55% 88%, rgba(255,255,255,0.42) 50%, transparent 52%);
      opacity:0.46;
      mix-blend-mode:screen;
    }

    .wrap{ max-width:980px; margin:0 auto; position:relative; }

    /* Header */
    .hero{
      position:relative;
      text-align:center;
      padding:8px 0 10px;
      margin-bottom:12px;
    }
    .title{
      margin:0;
      font-weight:950;
      letter-spacing:0.03em;
      line-height:0.92;
      font-size:clamp(44px, 6.2vw, 70px);
      text-transform:uppercase;
      background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(92,255,176,0.92));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow:0 14px 54px rgba(92,255,176,0.12);
    }
    .subtitle{
      margin:10px auto 0;
      max-width:840px;
      color:rgba(255,255,255,0.92);
      font-weight:850;
      font-size:clamp(14px, 1.9vw, 18px);
    }

    .header-accent{
      position:absolute;
      pointer-events:none;
      opacity:0.50;
      z-index:0;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .header-accent.left{
      left:-18px; top:-6px;
      width:52px;
      transform: rotate(-10deg);
      filter:
        hue-rotate(110deg)
        saturate(2.0)
        brightness(1.06)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .header-accent.right{
      right:-46px; top:-34px;
      width:128px;
      transform: rotate(10deg);
      filter:
        hue-rotate(135deg)
        saturate(1.8)
        brightness(1.06)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    @media (max-width: 640px){
      .header-accent.left{ left:-10px; top:-2px; width:46px; }
      .header-accent.right{ right:-34px; top:-26px; width:112px; }
    }

    /* Card */
    .card{
      position:relative;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(6px);
    }

    .map-area{ padding:14px 14px 10px; position:relative; }
    .map-shell{ position:relative; padding:14px; }

    /* Decorative accents OUTSIDE the map frame */
    .decor{
      position:absolute;
      pointer-events:none;
      z-index:0;
      opacity:0.22;
      filter:
        hue-rotate(125deg)
        saturate(2.0)
        brightness(1.06)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .decor.hero-ufo{
      width:140px;
      top:-50px;
      right:-70px;
      opacity:0.26;
      transform: rotate(12deg);
      filter:
        hue-rotate(145deg)
        saturate(1.9)
        brightness(1.08)
        drop-shadow(0 18px 28px rgba(0,0,0,0.45));
    }
    .decor.small{ width:44px; }
    .decor.left{ left:-30px; top:165px; transform: rotate(-8deg); }
    .decor.right{ right:-28px; top:245px; transform: rotate(10deg); }
    .decor.bottom-left{ left:-22px; bottom:125px; transform: rotate(12deg); }
    .decor.bottom-right{ right:-22px; bottom:98px; transform: rotate(-10deg); }

    .decor.tiny{ width:30px; opacity:0.14; }
    .decor.top-left{ left:8px; top:8px; transform: rotate(-10deg); }
    .decor.top-right{ right:12px; top:12px; transform: rotate(14deg); opacity:0.12; }
    .decor.mid-left{ left:-14px; top:220px; transform: rotate(-8deg); opacity:0.12; }
    .decor.mid-right{ right:-12px; top:210px; transform: rotate(9deg); opacity:0.12; }

    .map-frame{
      position:relative;
      z-index:1;
      background:rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:16px;
      overflow:hidden;
    }
    /* Subtle “scanner glow” behind the frame */
    .map-frame:before{
      content:"";
      position:absolute; inset:-22px;
      background:
        radial-gradient(520px 260px at 28% 18%, rgba(92,255,176,0.16), transparent 62%),
        radial-gradient(520px 280px at 72% 85%, rgba(21,230,194,0.12), transparent 64%),
        radial-gradient(520px 260px at 70% 15%, rgba(53,231,255,0.10), transparent 62%);
      filter: blur(12px);
      opacity:0.90;
      pointer-events:none;
    }

    svg{
      width:100%;
      height:auto;
      display:block;
      position:relative;
      z-index:1;
    }

    /* Regions */
    .region{
      stroke:rgba(1,1,10,1);
      stroke-width:4.6;
      stroke-linejoin:round;
      stroke-linecap:round;
      cursor:default;
    }
    .region:hover{
      stroke:rgba(255,255,255,0.78);
      stroke-width:4.6;
      filter:
        drop-shadow(0 0 10px rgba(92,255,176,0.18))
        drop-shadow(0 0 14px rgba(53,231,255,0.10));
    }

    /* Territories / no-data: lighter fill + softer border so it reads as “background land” */
    .region.nodata{
      fill: var(--nodata);
      stroke: rgba(255,255,255,0.12);
      stroke-width: 3.6;
    }
    .region.nodata:hover{
      stroke: rgba(255,255,255,0.20);
      stroke-width: 3.6;
      filter: none;
    }

    /* Optional outline mesh */
    .region-outline{
      fill:none;
      stroke:rgba(255,255,255,0.08);
      stroke-width:0.8;
      pointer-events:none;
    }

    /* Legend */
    .legend{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      padding:10px 14px 6px;
    }
    .legend .label{
      font-size:12px;
      font-weight:950;
      letter-spacing:0.06em;
      text-transform:uppercase;
      color:rgba(255,255,255,0.84);
      white-space:nowrap;
    }
    .legend .bar{
      width:min(360px, 68vw);
      height:14px;
      border-radius:999px;
      background:linear-gradient(90deg, var(--m0), var(--m1), var(--m2), var(--m3), var(--m4), var(--m5));
      border:1px solid rgba(255,255,255,0.18);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.18);
    }

    /* “not ranked” chip */
    .legend-note{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:0 14px 14px;
      color:rgba(255,255,255,0.72);
      font-size:11px;
      font-weight:850;
      letter-spacing:0.02em;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.16);
    }
    .swatch{
      width:14px; height:10px;
      border-radius:3px;
      border:1px solid rgba(255,255,255,0.18);
      background:var(--nodata);
    }

    .bigline{
      text-align:center;
      padding:8px 14px 0;
      font-weight:950;
      letter-spacing:0.04em;
      text-transform:uppercase;
      color:rgba(255,183,3,0.92);
      font-size:clamp(14px, 2vw, 16px);
    }

    /* Ranked list */
    .lists{
      padding:12px 14px 10px;
      display:grid;
      gap:10px;
      grid-template-columns:1fr;
    }
    @media (min-width: 760px){
      .lists{ grid-template-columns:repeat(2, 1fr); gap:14px; }
    }
    .col{
      background:rgba(0,0,0,0.10);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      padding:10px 10px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      padding:6px 6px;
      border-bottom:1px dashed rgba(255,255,255,0.10);
      font-size:14px;
      line-height:1.1;
    }
    .row:last-child{ border-bottom:none; }
    .name{
      font-weight:950;
      color:rgba(255,183,3,0.92);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .val{
      font-family:var(--mono);
      font-variant-numeric:tabular-nums;
      color:rgba(255,255,255,0.92);
      font-weight:950;
      white-space:nowrap;
    }

    /* Tooltip */
    .tooltip{
      position:absolute;
      pointer-events:none;
      display:none;
      z-index:100;
      background:rgba(6,0,20,0.92);
      border:1px solid rgba(255,255,255,0.16);
      border-radius:14px;
      padding:10px 12px;
      box-shadow:0 16px 40px rgba(0,0,0,0.45);
      max-width:300px;
      backdrop-filter: blur(8px);
    }
    .tooltip strong{
      display:block;
      font-weight:950;
      margin-bottom:4px;
      color:rgba(255,255,255,0.95);
    }
    .tooltip .mono{
      font-family:var(--mono);
      font-variant-numeric:tabular-nums;
      color:rgba(92,255,176,0.92);
      font-weight:950;
    }
    .tooltip .muted{
      margin-top:4px;
      font-size:11px;
      color:rgba(255,255,255,0.70);
      line-height:1.35;
    }

    /* Footer */
    .footer{
      margin-top:12px;
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background:rgba(0,0,0,0.16);
      border-top:1px solid rgba(255,255,255,0.10);
      position:relative;
    }
    .source{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      color:rgba(255,255,255,0.86);
      font-weight:900;
      letter-spacing:0.04em;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .source a{
      color:rgba(53,231,255,0.92);
      text-decoration:none;
      border-bottom:1px dotted rgba(53,231,255,0.55);
      font-weight:950;
      text-transform:none;
      letter-spacing:0;
    }
    .logo{
      height:58px;
      width:auto;
      display:block;
      filter: drop-shadow(0 12px 22px rgba(0,0,0,0.45));
    }
    .footer-art{
      display:flex;
      align-items:flex-end;
      gap:10px;
      pointer-events:none;
      opacity:0.90;
    }
    .footer-art img:nth-child(1){
      height:36px;
      transform: rotate(-6deg);
      filter: hue-rotate(145deg) saturate(1.9) brightness(1.08) drop-shadow(0 14px 22px rgba(0,0,0,0.45));
    }
    .footer-art img:nth-child(2){
      height:44px;
      transform: rotate(10deg) translateY(2px);
      filter: hue-rotate(30deg) saturate(1.6) brightness(1.10) drop-shadow(0 14px 22px rgba(0,0,0,0.45));
    }

    .method{
      padding:10px 14px 14px;
      font-size:11px;
      line-height:1.35;
      color:rgba(255,255,255,0.72);
      border-top:1px solid rgba(255,255,255,0.08);
      background:rgba(0,0,0,0.10);
    }
    .method strong{ color:rgba(255,255,255,0.88); }

    .embed{
      padding:12px 14px 16px;
      background:rgba(0,0,0,0.10);
      border-top:1px solid rgba(255,255,255,0.08);
    }
    .embed-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,0.18);
      background:linear-gradient(90deg, rgba(255,183,3,0.95), rgba(255,122,89,0.88));
      color:#01010a;
      font-weight:950;
      letter-spacing:0.02em;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 14px 30px rgba(0,0,0,0.30);
    }
    .embed-btn:hover{ filter:brightness(1.03); transform: translateY(-1px); }
    .embed-panel[hidden]{ display:none; }
    .embed-panel{
      margin-top:10px;
      border:1px solid rgba(255,255,255,0.12);
      border-radius:14px;
      overflow:hidden;
      background:rgba(1,1,10,0.55);
    }
    .embed-panel .hint{
      padding:10px 12px;
      font-size:11px;
      color:rgba(255,255,255,0.72);
      border-bottom:1px solid rgba(255,255,255,0.10);
    }
    .embed-panel textarea{
      width:100%;
      height:130px;
      padding:10px 12px;
      border:0;
      outline:none;
      resize:none;
      background:transparent;
      color:rgba(255,255,255,0.92);
      font:12px/1.4 var(--mono);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <h1 class="title">Alien Hotspots</h1>
      <div class="subtitle">Implied odds of reported alien abductions, by province</div>

      <img class="header-accent left"
           src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
           alt="" aria-hidden="true">
      <img class="header-accent right"
           src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
           alt="" aria-hidden="true">
    </div>

    <div class="card">
      <div class="map-area">
        <div class="map-shell">
          <img class="decor hero-ufo"
               src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
               alt="" aria-hidden="true">

          <img class="decor small left"
               src="https://i.postimg.cc/BvT5qYTs/1083598.png"
               alt="" aria-hidden="true">

          <img class="decor small right"
               src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
               alt="" aria-hidden="true">

          <img class="decor small bottom-left"
               src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
               alt="" aria-hidden="true">

          <img class="decor small bottom-right"
               src="https://i.postimg.cc/BvT5qYTs/1083598.png"
               alt="" aria-hidden="true">

          <img class="decor tiny top-left"
               src="https://i.postimg.cc/BvT5qYTs/1083598.png"
               alt="" aria-hidden="true">
          <img class="decor tiny mid-left"
               src="https://i.postimg.cc/4NjppkwV/pngtree-alien-image-png-image-20791020.png"
               alt="" aria-hidden="true">
          <img class="decor tiny top-right"
               src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
               alt="" aria-hidden="true">
          <img class="decor tiny mid-right"
               src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png"
               alt="" aria-hidden="true">

          <div class="map-frame">
            <svg id="map" viewBox="0 0 975 610" role="img" aria-label="Alien Hotspots Canada map"></svg>
          </div>
        </div>
      </div>

      <div class="legend" aria-label="Legend">
        <div class="label">Lower odds</div>
        <div class="bar" aria-hidden="true"></div>
        <div class="label">Higher odds</div>
      </div>

      <div class="legend-note" aria-label="Territories note">
        <span class="chip"><span class="swatch" aria-hidden="true"></span> Northern territories shown for context (not ranked)</span>
      </div>

      <div class="bigline">Implied odds — % and “1 in X”</div>
      <div class="lists" id="lists"></div>

      <div class="footer">
        <div class="source">
          Source: Canada Sports Betting
          <a href="https://www.canadasportsbetting.ca/" target="_blank" rel="noopener">canadasportsbetting.ca</a>
        </div>

        <img class="logo" src="https://i.postimg.cc/5NCzmKXQ/download.png" alt="Canada Sports Betting logo" />

        <div class="footer-art" aria-hidden="true">
          <img src="https://i.postimg.cc/02hBWNPW/ufo-in-cartoon-style-clipart-md.png" alt="">
          <img src="https://i.postimg.cc/BvT5qYTs/1083598.png" alt="">
        </div>
      </div>

      <div class="method">
        <strong>Methodology:</strong> Per-capita ranking of abduction-style UFO reports (2019–2024). % and “1 in X” are implied odds for comparison only (not predictions).
        <br><br>
        <strong>Note:</strong> Territories are displayed on the map but are not included in this provincial ranking table.
        <br><br>
        <strong>Sources:</strong> NUFORC, Canadian UFO Survey, Statistics Canada, Google Trends.
      </div>

      <div class="embed">
        <button class="embed-btn" id="embedToggle" type="button" aria-controls="embedPanel" aria-expanded="false">
          Get embed code
        </button>

        <div class="embed-panel" id="embedPanel" hidden>
          <div class="hint">Copy/paste this iframe. Replace the <strong>src</strong> with your hosted URL.</div>
          <textarea id="embedCode" readonly onclick="this.select()"></textarea>
        </div>
      </div>
    </div>
  </div>

  <div class="tooltip" id="tt"></div>

  <script>
    // =========================
    // CANADA DATA (provinces only)
    // =========================
    const alienData = {
      "British Columbia":          { abbr:"BC", rank:1,  score:100.00, prob:2.00, oddsX:50  },
      "Alberta":                   { abbr:"AB", rank:2,  score:99.16,  prob:1.98, oddsX:51  },
      "New Brunswick":             { abbr:"NB", rank:3,  score:77.61,  prob:1.55, oddsX:65  },
      "Quebec":                    { abbr:"QC", rank:4,  score:70.15,  prob:1.40, oddsX:71  },
      "Nova Scotia":               { abbr:"NS", rank:5,  score:68.41,  prob:1.37, oddsX:73  },
      "Saskatchewan":              { abbr:"SK", rank:6,  score:66.35,  prob:1.33, oddsX:75  },
      "Ontario":                   { abbr:"ON", rank:7,  score:61.19,  prob:1.22, oddsX:82  },
      "Manitoba":                  { abbr:"MB", rank:8,  score:52.74,  prob:1.05, oddsX:95  },
      "Newfoundland and Labrador": { abbr:"NL", rank:9,  score:45.21,  prob:0.90, oddsX:111 },
      "Prince Edward Island":      { abbr:"PE", rank:10, score:35.39,  prob:0.70, oddsX:143 }
    };

    // Color scale (GREEN -> TEAL)
    const ramp = ["#E9FFF4","#B8FFD9","#5CFFB0","#15E6C2","#08A6A6","#034C4F"];
    const color = d3.scaleQuantize().domain([0, 100]).range(ramp);

    const NO_DATA_FILL = getComputedStyle(document.documentElement).getPropertyValue("--nodata").trim() || "#4A5E59";

    const svg = d3.select("#map");
    const tooltip = d3.select("#tt");

    const W = 975, H = 610;

    function esc(s){
      return String(s).replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }

    // Normalizes common naming differences from the topojson file
    function normalizeName(n){
      if(!n) return n;
      const s = String(n).trim();
      const map = new Map([
        ["Québec","Quebec"],
        ["Newfoundland & Labrador","Newfoundland and Labrador"],
        ["Prince Edward Island / Île-du-Prince-Édouard","Prince Edward Island"]
      ]);
      return map.get(s) || s;
    }

    function placeTooltip(event){
      const rect = tooltip.node().getBoundingClientRect();
      const pad = 10;
      let x = event.pageX + 12;
      let y = event.pageY + 12;
      if (x + rect.width > window.innerWidth - pad) x = window.innerWidth - rect.width - pad;
      if (y + rect.height > window.innerHeight - pad) y = window.innerHeight - rect.height - pad;
      tooltip.style("left", x+"px").style("top", y+"px");
    }

    function showTip(event, regionName, d){
      tooltip
        .style("display","block")
        .html(
          `<strong>${esc(regionName)}${d?.abbr ? ` (${esc(d.abbr)})` : ""}</strong>
           <div class="mono">${d.prob.toFixed(2)}% • 1 in ${d.oddsX}</div>
           <div class="muted">Implied odds • Rank ${d.rank}</div>`
        );
      placeTooltip(event);
    }
    function showNoDataTip(event, regionName){
      tooltip
        .style("display","block")
        .html(
          `<strong>${esc(regionName)}</strong>
           <div class="mono">Not ranked</div>
           <div class="muted">Shown for map context only.</div>`
        );
      placeTooltip(event);
    }
    function hideTip(){ tooltip.style("display","none"); }

    // Build 2-column ranked list (10 entries)
    const rows = Object.entries(alienData)
      .map(([name, v]) => ({ name, ...v }))
      .sort((a,b)=>a.rank-b.rank);

    const cols = 2;
    const perCol = Math.ceil(rows.length / cols);
    const lists = document.getElementById("lists");
    lists.innerHTML = "";

    for(let c=0; c<cols; c++){
      const start = c*perCol;
      const chunk = rows.slice(start, start+perCol);
      const col = document.createElement("div");
      col.className = "col";
      col.innerHTML = chunk.map(r => `
        <div class="row">
          <div class="name">${esc(r.name)}</div>
          <div class="val">${r.prob.toFixed(2)}% · 1 in ${r.oddsX}</div>
        </div>
      `).join("");
      lists.appendChild(col);
    }

    // =========================
    // CANADA MAP LOAD (same pattern as USA: d3.json + topojson.feature)
    // =========================
    const CANADA_TOPOJSON =
      "https://code.highcharts.com/mapdata/countries/ca/ca-all.topo.json";

    // Projection: fit to data (prevents weird cropping)
    const projection = d3.geoMercator();
    const path = d3.geoPath(projection);

    d3.json(CANADA_TOPOJSON).then(topo => {
      const objKey = topo.objects && (topo.objects.default ? "default" : Object.keys(topo.objects)[0]);
      const features = topojson.feature(topo, topo.objects[objKey]).features;

      projection.fitSize([W, H], { type:"FeatureCollection", features });
      svg.attr("viewBox", `0 0 ${W} ${H}`);

      svg.selectAll("path.region")
        .data(features)
        .join("path")
        .attr("class", f => {
          const name = normalizeName(f.properties && (f.properties.name || f.properties.NAME || f.properties.Name));
          return alienData[name] ? "region" : "region nodata";
        })
        .attr("d", path)
        .attr("fill", f => {
          const name = normalizeName(f.properties && (f.properties.name || f.properties.NAME || f.properties.Name));
          const d = alienData[name];
          return d ? color(d.score) : NO_DATA_FILL;
        })
        .on("mousemove", (event, f) => {
          const name = normalizeName(f.properties && (f.properties.name || f.properties.NAME || f.properties.Name)) || "Unknown";
          const d = alienData[name];
          if(!d) return showNoDataTip(event, name);
          showTip(event, name, d);
        })
        .on("mouseout", hideTip)
        .on("click", (event, f) => {
          const name = normalizeName(f.properties && (f.properties.name || f.properties.NAME || f.properties.Name)) || "Unknown";
          const d = alienData[name];
          if(!d) return showNoDataTip(event, name);
          showTip(event, name, d);
          event.stopPropagation();
        });

      // Subtle outline mesh
      svg.append("path")
        .datum(topojson.mesh(topo, topo.objects[objKey], (a,b)=>a!==b))
        .attr("class","region-outline")
        .attr("d", path);

      document.addEventListener("click", hideTip);
      document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") hideTip(); });
    }).catch(err => {
      console.error("Canada topojson failed to load:", err);
    });

    // Embed logic
    const embedToggle = document.getElementById("embedToggle");
    const embedPanel  = document.getElementById("embedPanel");
    const embedCode   = document.getElementById("embedCode");

    if (embedCode) {
      embedCode.value =
`<iframe
  src="https://aharris-jpg.github.io/aliens/canada.html"
  title="Alien Hotspots — Implied odds of reported alien abductions, by province"
  width="100%" height="900"
  style="border:0;overflow:hidden;display:block;width:100%;"
  loading="lazy"></iframe>`;
    }

    if (embedToggle) {
      embedToggle.addEventListener("click", () => {
        const hidden = embedPanel.hasAttribute("hidden");
        if (hidden) {
          embedPanel.removeAttribute("hidden");
          embedToggle.setAttribute("aria-expanded", "true");
          embedToggle.textContent = "Hide embed code";
        } else {
          embedPanel.setAttribute("hidden", "");
          embedToggle.setAttribute("aria-expanded", "false");
          embedToggle.textContent = "Get embed code";
        }
      });
    }
  </script>
</body>
</html>
